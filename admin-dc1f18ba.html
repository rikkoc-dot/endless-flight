<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--

-->
<title>ç®¡ç†ç”»é¢ | ãƒ¢ãƒã‚¤ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

<script type="module">
  import { initializeApp }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, onValue, update }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // ============================================================
  // ğŸ”¥ FIREBASE CONFIG
  // mobile-order.html ã¨åŒã˜å€¤ã‚’è¨­å®š
  //
  // âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼ˆå¿…é ˆï¼‰:
  //   Firebase Console â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š â†’ å…¨èˆ¬ â†’ ã€ŒAPIã‚­ãƒ¼ã‚’åˆ¶é™ã€
  //   â†’ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶é™ï¼šHTTPãƒªãƒ•ã‚¡ãƒ©ãƒ¼
  //   â†’ https://yourdomain.com/* ã®ã¿è¨±å¯ã™ã‚‹ã“ã¨
  //
  // Firebase Security Rulesï¼ˆRealtime Databaseï¼‰:
  // {
  //   "rules": {
  //     "settings":  { ".read": true,  ".write": "auth != null" },
  //     "products":  { ".read": true,  ".write": "auth != null" },
  //     "orders":    { ".read": "auth != null", ".write": true  },
  //     "$other":    { ".read": false, ".write": false }
  //   }
  // }
  // ============================================================
  const firebaseConfig = {
  apiKey: "AIzaSyAREokLFrgO_Wh6x0Dobm4a-oUPOonXu94",
  authDomain: "mobaileordersystem.firebaseapp.com",
  databaseURL: "https://mobaileordersystem-default-rtdb.firebaseio.com",
  projectId: "mobaileordersystem",
  storageBucket: "mobaileordersystem.firebasestorage.app",
  messagingSenderId: "280115059343",
  appId: "1:280115059343:web:f3dc729af540662722eefa"
  };

  const app  = initializeApp(firebaseConfig);
  const db   = getDatabase(app);
  const auth = getAuth(app);

  // -------------------------------------------------------
  // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç›£è¦–
  // æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã¿è¡¨ç¤ºï¼ˆadmin DOM ã¯éè¡¨ç¤ºï¼‰
  // -------------------------------------------------------
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-screen').style.display = 'block';
      // textContent ã§ XSS é˜²æ­¢
      document.getElementById('user-email').textContent = user.email;
      listenSettings();
      listenProducts();
    } else {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('admin-screen').style.display = 'none';
    }
  });

  // -------------------------------------------------------
  // ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ#5 å¯¾å‡¦ï¼šã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
  // -------------------------------------------------------
  let loginAttempts = 0;
  let loginLocked   = false;

  window.doLogin = async () => {
    if (loginLocked) {
      document.getElementById('login-error').textContent =
        'ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
      return;
    }

    const email = document.getElementById('input-email').value.trim();
    const pass  = document.getElementById('input-pass').value;
    const errEl = document.getElementById('login-error');
    const btn   = document.getElementById('login-btn');
    errEl.textContent = '';
    btn.disabled = true;

    try {
      await signInWithEmailAndPassword(auth, email, pass);
      loginAttempts = 0;
    } catch {
      loginAttempts++;
      // 5å›å¤±æ•—ã§30ç§’ãƒ­ãƒƒã‚¯ï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–ï¼‰
      if (loginAttempts >= 5) {
        loginLocked = true;
        errEl.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚30ç§’å¾Œã«å†è©¦è¡Œã§ãã¾ã™ã€‚';
        setTimeout(() => { loginLocked = false; loginAttempts = 0; errEl.textContent = ''; }, 30000);
      } else {
        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å­˜åœ¨ç¢ºèªã‚’é˜²ããŸã‚ã€ç†ç”±ã‚’åŒºåˆ¥ã—ãªã„
        errEl.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
      }
    } finally {
      btn.disabled = false;
    }
  };

  // -------------------------------------------------------
  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  // -------------------------------------------------------
  window.doLogout = async () => { await signOut(auth); };

  // -------------------------------------------------------
  // è¨­å®šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
  // -------------------------------------------------------
  function listenSettings() {
    onValue(ref(db, 'settings'), (snap) => {
      const s = snap.val() || {};
      const wt = document.getElementById('wt-input');
      const st = document.getElementById('st-input');
      const sm = document.getElementById('sm-input');
      if (wt && !wt.matches(':focus')) wt.value = s.waitTime ?? '';
      if (st && !st.matches(':focus')) st.value = s.saleStartTime ?? '';
      // ãŠçŸ¥ã‚‰ã›ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã™ã‚‹ã®ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºä¸è¦ï¼ˆé€ä¿¡å´ã§æ¤œè¨¼ï¼‰
      if (sm && !sm.matches(':focus')) sm.value = s.saleMessage ?? '';

      const toggle = document.getElementById('open-toggle');
      if (toggle) { toggle.checked = s.isOpen !== false; updateToggleLabel(s.isOpen !== false); }
    });
  }

  // -------------------------------------------------------
  // å•†å“ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
  // -------------------------------------------------------
  function listenProducts() {
    onValue(ref(db, 'products'), (snap) => {
      renderProductList(snap.val() || {});
    });
  }

  // -------------------------------------------------------
  // è¨­å®šä¿å­˜ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã¯ Security Rules ã§ä¿è­·ï¼‰
  // -------------------------------------------------------
  window.saveSettings = async () => {
    // waitTime ã¯ 0ã€œ999 ã®æ•´æ•°ã«åˆ¶é™
    const rawWt   = Number(document.getElementById('wt-input').value);
    const waitTime = Number.isFinite(rawWt) ? Math.max(0, Math.min(999, Math.floor(rawWt))) : 0;
    const saleStart   = document.getElementById('st-input').value.trim();
    // saleMessage ã¯ 200æ–‡å­—ä»¥å†…ã«åˆ¶é™
    const saleMessage = document.getElementById('sm-input').value.trim().slice(0, 200);
    const isOpen      = document.getElementById('open-toggle').checked;

    try {
      await set(ref(db, 'settings'), { waitTime, saleStartTime: saleStart, isOpen, saleMessage });
      showToast('âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    } catch (e) {
      showToast('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + escHtml(e.message));
    }
  };

  // -------------------------------------------------------
  // å¾…ã¡æ™‚é–“ã‚¯ã‚¤ãƒƒã‚¯æ›´æ–°
  // -------------------------------------------------------
  window.quickWaitTime = async (val) => {
    document.getElementById('wt-input').value = val;
    await update(ref(db, 'settings'), { waitTime: val });
    showToast(`â± å¾…ã¡æ™‚é–“ã‚’ ${val}åˆ† ã«æ›´æ–°ã—ã¾ã—ãŸ`);
  };

  // -------------------------------------------------------
  // è²©å£²ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒˆã‚°ãƒ«
  // -------------------------------------------------------
  window.toggleOpen = async () => {
    const isOpen = document.getElementById('open-toggle').checked;
    await update(ref(db, 'settings'), { isOpen });
    updateToggleLabel(isOpen);
    showToast(isOpen ? 'âœ… è²©å£²é–‹å§‹ã«è¨­å®šã—ã¾ã—ãŸ' : 'ğŸ”´ è²©å£²çµ‚äº†ã«è¨­å®šã—ã¾ã—ãŸ');
  };

  function updateToggleLabel(isOpen) {
    const label = document.getElementById('toggle-label');
    if (!label) return;
    label.textContent  = isOpen ? 'è²©å£²ä¸­' : 'è²©å£²çµ‚äº†';
    label.style.color  = isOpen ? '#059669' : '#dc2626';
    label.style.fontWeight = '700';
  }

  // -------------------------------------------------------
  // å•†å“åœ¨åº«ãƒˆã‚°ãƒ«ï¼ˆDB ãƒ‘ã‚¹ã¯ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§åˆ¶é™ï¼‰
  // -------------------------------------------------------
  const VALID_PRODUCT_IDS = [1,2,3,4,5,6,7,8,9,10];

  window.toggleSoldOut = async (id, current) => {
    // id ãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆå†…ã®æ•´æ•°ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‘ã‚¹æ“ä½œã‚’é˜²ãï¼‰
    if (!VALID_PRODUCT_IDS.includes(Number(id))) {
      showToast('âŒ ä¸æ­£ãªå•†å“IDã§ã™');
      return;
    }
    const newVal = !current;
    await update(ref(db, `products/${Number(id)}`), { soldOut: newVal });
    showToast(newVal ? `ğŸš« ID:${id} ã‚’å£²ã‚Šåˆ‡ã‚Œã«è¨­å®š` : `âœ… ID:${id} ã‚’è²©å£²ä¸­ã«è¨­å®š`);
  };
// -------------------------------------------------------
// QRã‚³ãƒ¼ãƒ‰ã®æ³¨æ–‡IDã‚’èª­ã¿å–ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ï¼ˆè¿½åŠ ï¼‰
// -------------------------------------------------------
window.loadOrder = () => {
  const urlParams = new URLSearchParams(window.location.search);
  const orderId = urlParams.get('id'); // URLã® ?id=... ã‚’å–å¾—

  if (!orderId) return;

  // Firebaseã‹ã‚‰è©²å½“ã™ã‚‹æ³¨æ–‡IDã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  onValue(ref(db, 'orders/' + orderId), (snap) => {
    const orderData = snap.val();
    if (orderData) {
      // ç”»é¢ã«è¡¨ç¤ºã™ã‚‹å‡¦ç†ï¼ˆç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯è¡¨ç¤ºã‚¨ãƒªã‚¢ãŒãªã„ãŸã‚ã€
      // ã©ã“ã«è¡¨ç¤ºã™ã‚‹ã‹HTMLã®ä¿®æ­£ã‚‚å¿…è¦ã§ã™ï¼‰
      console.log("æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿:", orderData);
      showToast(`æ³¨æ–‡ID: ${orderId} ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
    } else {
      showToast("ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");
    }
  });
};

// ç”»é¢èª­ã¿è¾¼ã¿æ™‚ã«æ³¨æ–‡ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
window.addEventListener('load', loadOrder);
  // -------------------------------------------------------
  // å•†å“ãƒªã‚¹ãƒˆæç”»ï¼ˆ#4 å¯¾å‡¦ï¼šinnerHTML ã‚’ escHtml ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰
  // -------------------------------------------------------
  function renderProductList(dbProducts) {
    const list = document.getElementById('product-list');
    if (!list) return;
    list.innerHTML = ADMIN_PRODUCTS.map(p => {
      const dbData  = dbProducts[p.id] || {};
      const soldOut = typeof dbData.soldOut === 'boolean' ? dbData.soldOut : p.defaultSoldOut;
      return `
        <div class="product-row ${soldOut ? 'sold-out-row' : ''}">
          <div class="product-row-emoji">${p.emoji}</div>
          <div class="product-row-info">
            <div class="product-row-name">${escHtml(p.name)}</div>
            <div class="product-row-price">Â¥${p.price.toLocaleString()}</div>
          </div>
          <div class="product-row-action">
            <button class="stock-btn ${soldOut ? 'btn-soldout' : 'btn-instock'}"
              onclick="toggleSoldOut(${Number(p.id)}, ${Boolean(soldOut)})">
              ${soldOut ? 'å£²ã‚Šåˆ‡ã‚Œ' : 'è²©å£²ä¸­'}
            </button>
          </div>
        </div>`;
    }).join('');
  }

  // Enter ã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' &&
        document.getElementById('login-screen').style.display !== 'none' &&
        !loginLocked) {
      doLogin();
    }
  });
</script>

<style>
  :root {
    --primary: #c0003c; --primary-light: #e8003d; --primary-pale: #fff0f3;
    --bg: #f4f3f1; --surface: #ffffff; --surface2: #f5f4f2;
    --border: #e8e4df; --border-strong: #d5cfc9;
    --text: #1a1714; --text-muted: #8a847e; --text-light: #b5afa9;
    --green: #059669; --green-pale: #ecfdf5; --red: #dc2626; --red-pale: #fef2f2;
    --shadow: rgba(26,23,20,0.07); --shadow-md: rgba(26,23,20,0.12);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Noto Sans JP', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

  /* LOGIN */
  #login-screen {
    min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px;
    background: linear-gradient(150deg, #fff 0%, #fff8f9 60%, #fff0f3 100%);
  }
  .login-box {
    background: #fff; border: 1px solid var(--border); border-radius: 24px; padding: 40px 32px;
    width: 100%; max-width: 380px; box-shadow: 0 8px 32px var(--shadow-md); text-align: center;
  }
  .login-logo { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 600; letter-spacing: 3px; color: var(--primary); margin-bottom: 4px; }
  .login-sub { font-size: 11px; color: var(--text-muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 32px; }
  .login-label { display: block; font-size: 11px; font-weight: 700; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px; text-align: left; }
  .login-input {
    width: 100%; padding: 13px 16px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; font-family: 'Noto Sans JP', sans-serif; font-size: 14px; color: var(--text);
    margin-bottom: 16px; outline: none; transition: border-color 0.2s;
  }
  .login-input:focus { border-color: var(--primary); background: #fff; }
  .login-btn {
    width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 12px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s; box-shadow: 0 4px 14px rgba(192,0,60,0.22); margin-top: 4px;
  }
  .login-btn:hover { background: var(--primary-light); }
  .login-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  #login-error { font-size: 12px; color: var(--red); margin-top: 12px; min-height: 18px; line-height: 1.5; }

  /* ADMIN */
  #admin-screen { display: none; }

  .admin-header {
    background: #fff; border-bottom: 1px solid var(--border); padding: 0 24px; height: 58px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 50; box-shadow: 0 1px 8px var(--shadow);
  }
  .admin-header-title { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 600; color: var(--primary); letter-spacing: 2px; }
  .admin-header-sub { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  #user-email { font-size: 11px; color: var(--text-muted); }
  .logout-btn {
    padding: 7px 14px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; font-size: 12px; color: var(--text-muted);
    cursor: pointer; transition: all 0.18s; font-family: 'Noto Sans JP', sans-serif;
  }
  .logout-btn:hover { background: var(--red-pale); color: var(--red); border-color: rgba(220,38,38,0.3); }

  .admin-body { max-width: 800px; margin: 0 auto; padding: 28px 20px 60px; }

  .section-card { background: #fff; border: 1px solid var(--border); border-radius: 20px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 12px var(--shadow); }
  .section-card-title { font-size: 13px; font-weight: 900; letter-spacing: 1px; margin-bottom: 20px; padding-bottom: 14px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; }

  /* TOGGLE */
  .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: var(--surface2); border-radius: 14px; margin-bottom: 20px; }
  .toggle-info .toggle-title { font-size: 14px; font-weight: 700; margin-bottom: 3px; }
  .toggle-info .toggle-desc { font-size: 11px; color: var(--text-muted); }
  .toggle-switch { position: relative; display: inline-block; width: 52px; height: 28px; }
  .toggle-switch input { opacity: 0; width: 0; height: 0; }
  .toggle-slider { position: absolute; cursor: pointer; inset: 0; background: #ccc; border-radius: 28px; transition: .3s; }
  .toggle-slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: .3s; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }
  .toggle-switch input:checked + .toggle-slider { background: var(--green); }
  .toggle-switch input:checked + .toggle-slider:before { transform: translateX(24px); }
  #toggle-label { font-size: 13px; font-weight: 700; color: var(--green); margin-left: 10px; min-width: 60px; }

  /* FORM */
  .quick-btns { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
  .quick-btn {
    padding: 8px 16px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.18s;
    font-family: 'Noto Sans JP', sans-serif; color: var(--text);
  }
  .quick-btn:hover { background: var(--primary-pale); border-color: rgba(192,0,60,0.3); color: var(--primary); }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
  @media (max-width: 480px) { .form-row { grid-template-columns: 1fr; } }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-label { font-size: 11px; font-weight: 700; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; }
  .form-input {
    padding: 11px 14px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; font-family: 'Noto Sans JP', sans-serif; font-size: 14px; color: var(--text);
    outline: none; transition: border-color 0.2s;
  }
  .form-input:focus { border-color: var(--primary); background: #fff; }
  .form-textarea {
    padding: 11px 14px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; font-family: 'Noto Sans JP', sans-serif; font-size: 13px; color: var(--text);
    outline: none; transition: border-color 0.2s; resize: vertical; min-height: 70px; width: 100%; margin-bottom: 6px;
  }
  .form-textarea:focus { border-color: var(--primary); background: #fff; }
  .form-hint { font-size: 11px; color: var(--text-light); margin-bottom: 14px; }

  .save-btn {
    width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 12px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s; box-shadow: 0 4px 14px rgba(192,0,60,0.22);
  }
  .save-btn:hover { background: var(--primary-light); }

  /* PRODUCT LIST */
  #product-list { display: flex; flex-direction: column; gap: 8px; }
  .product-row { display: flex; align-items: center; gap: 14px; padding: 12px 16px; background: var(--surface2); border: 1px solid var(--border); border-radius: 14px; transition: opacity 0.2s; }
  .sold-out-row { opacity: 0.55; }
  .product-row-emoji { font-size: 28px; width: 36px; text-align: center; flex-shrink: 0; }
  .product-row-info { flex: 1; }
  .product-row-name { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
  .product-row-price { font-size: 12px; color: var(--text-muted); }
  .stock-btn { padding: 7px 14px; border: none; border-radius: 8px; font-family: 'Noto Sans JP', sans-serif; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.18s; white-space: nowrap; }
  .btn-instock { background: var(--green-pale); color: var(--green); }
  .btn-instock:hover { background: #d1fae5; }
  .btn-soldout { background: var(--red-pale); color: var(--red); }
  .btn-soldout:hover { background: #fee2e2; }

  /* SETUP GUIDE */
  .setup-guide { background: linear-gradient(135deg, #fffbec, #fff8f0); border: 1px solid #f0d060; border-radius: 16px; padding: 20px 24px; margin-bottom: 20px; }
  .setup-guide-title { font-size: 13px; font-weight: 900; color: #7a6000; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
  .setup-step { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; border-bottom: 1px dashed #f0d060; }
  .setup-step:last-child { border-bottom: none; }
  .setup-step-num { min-width: 24px; height: 24px; background: #f0d060; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 900; color: #7a6000; flex-shrink: 0; }
  .setup-step-text { font-size: 12px; color: #7a6000; line-height: 1.6; }
  .setup-step-text code { background: rgba(240,192,64,0.3); padding: 1px 5px; border-radius: 4px; font-size: 11px; font-family: monospace; }

  /* TOAST */
  .toast {
    position: fixed; top: 20px; right: 20px;
    background: var(--text); color: #fff; padding: 12px 20px; border-radius: 12px;
    font-size: 13px; font-weight: 700; z-index: 999; opacity: 0; pointer-events: none;
    transition: all 0.25s; white-space: nowrap; box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    transform: translateY(-8px);
  }
  .toast.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">Mobile Order</div>
    <div class="login-sub">Admin Console</div>
    <label class="login-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
    <input id="input-email" class="login-input" type="email" placeholder="admin@example.com" autocomplete="username">
    <label class="login-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input id="input-pass" class="login-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
    <button id="login-btn" class="login-btn" onclick="doLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <div id="login-error"></div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin-screen">
  <header class="admin-header">
    <div>
      <div class="admin-header-title">Admin Console</div>
      <div class="admin-header-sub">Mobile Order Management</div>
    </div>
    <div class="header-right">
      <span id="user-email"></span>
      <button class="logout-btn" onclick="doLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </header>

  <div class="admin-body">



    <!-- è²©å£²ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="section-card">
      <div class="section-card-title">ğŸ”´ è²©å£²ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
      <div class="toggle-row">
        <div class="toggle-info">
          <div class="toggle-title">è²©å£²ã®ON / OFF</div>
          <div class="toggle-desc">OFFã«ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«ã€Œè²©å£²çµ‚äº†ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <label class="toggle-switch">
            <input type="checkbox" id="open-toggle" checked onchange="toggleOpen()">
            <span class="toggle-slider"></span>
          </label>
          <span id="toggle-label">è²©å£²ä¸­</span>
        </div>
      </div>
    </div>

    <!-- å¾…ã¡æ™‚é–“ãƒ»è¨­å®š -->
    <div class="section-card">
      <div class="section-card-title">â± å¾…ã¡æ™‚é–“ãƒ»è²©å£²æƒ…å ±</div>
      <div class="form-label" style="margin-bottom:10px;">å¾…ã¡æ™‚é–“ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š</div>
      <div class="quick-btns">
        <button class="quick-btn" onclick="quickWaitTime(0)">ãªã—</button>
        <button class="quick-btn" onclick="quickWaitTime(5)">5åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(10)">10åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(15)">15åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(20)">20åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(30)">30åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(45)">45åˆ†</button>
        <button class="quick-btn" onclick="quickWaitTime(60)">60åˆ†</button>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">å¾…ã¡æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
          <input id="wt-input" class="form-input" type="number" min="0" max="999" placeholder="ä¾‹: 15">
        </div>
        <div class="form-group">
          <label class="form-label">è²©å£²é–‹å§‹æ™‚åˆ»</label>
          <input id="st-input" class="form-input" type="time" value="12:00">
        </div>
      </div>
      <div class="form-label" style="margin-bottom:6px;">ãŠçŸ¥ã‚‰ã›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰</div>
      <textarea id="sm-input" class="form-textarea" placeholder="ä¾‹: æœ¬æ—¥ã¯12:00ã‚ˆã‚Šè²©å£²é–‹å§‹äºˆå®šã§ã™ã€‚" maxlength="200"></textarea>
      <div class="form-hint">â€» æœ€å¤§200æ–‡å­—</div>
      <button class="save-btn" onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜ã™ã‚‹</button>
    </div>

    <!-- å•†å“åœ¨åº«ç®¡ç† -->
    <div class="section-card">
      <div class="section-card-title">ğŸ› å•†å“åœ¨åº«ç®¡ç†</div>
      <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">ã‚¿ãƒƒãƒ—ã§ã€Œè²©å£²ä¸­ â†” å£²ã‚Šåˆ‡ã‚Œã€ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚å¤‰æ›´ã¯å³åº§ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«åæ˜ ã•ã‚Œã¾ã™ã€‚</p>
      <div id="product-list">
        <div style="text-align:center;padding:30px;color:var(--text-muted);font-size:13px;">Firebaseæ¥ç¶šå¾Œã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
      </div>
    </div>

  </div>
</div>

<script>
// ============================================================
// XSSã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆ#4 å¯¾å‡¦ï¼‰
// ============================================================
function escHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

// ============================================================
// ç®¡ç†ç”»é¢ç”¨å•†å“ãƒã‚¹ã‚¿ãƒ¼
// ============================================================
const ADMIN_PRODUCTS = [
  { id: 1,  name: "ãƒ„ã‚¢ãƒ¼Tã‚·ãƒ£ãƒ„ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆï¼‰", price: 3800, emoji: "ğŸ‘•", defaultSoldOut: false },
  { id: 2,  name: "ãƒ„ã‚¢ãƒ¼Tã‚·ãƒ£ãƒ„ï¼ˆãƒ–ãƒ©ãƒƒã‚¯ï¼‰", price: 3800, emoji: "ğŸ–¤", defaultSoldOut: false },
  { id: 3,  name: "ãƒ•ã‚©ãƒˆãƒ–ãƒƒã‚¯",               price: 2500, emoji: "ğŸ“–", defaultSoldOut: false },
  { id: 4,  name: "ã‚¿ã‚ªãƒ«",                     price: 1500, emoji: "ğŸ§£", defaultSoldOut: false },
  { id: 5,  name: "ã‚¢ã‚¯ãƒªãƒ«ã‚¹ã‚¿ãƒ³ãƒ‰",           price: 2000, emoji: "âœ¨", defaultSoldOut: false },
  { id: 6,  name: "ãƒ©ãƒ³ãƒ€ãƒ ç¼¶ãƒãƒƒã‚¸",           price: 500,  emoji: "ğŸ–", defaultSoldOut: false },
  { id: 7,  name: "ãƒšãƒ³ãƒ©ã‚¤ãƒˆ",                 price: 2800, emoji: "ğŸ’¡", defaultSoldOut: false },
  { id: 8,  name: "ãƒ‘ãƒ¼ã‚«ãƒ¼",                   price: 6500, emoji: "ğŸ§¥", defaultSoldOut: true  },
  { id: 9,  name: "ã‚¯ãƒªã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚»ãƒƒãƒˆ",       price: 1200, emoji: "ğŸ“", defaultSoldOut: false },
  { id: 10, name: "ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼",               price: 800,  emoji: "ğŸ”‘", defaultSoldOut: false },
];

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>
